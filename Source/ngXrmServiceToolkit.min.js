var ngXrm;(function(n){var t;(function(n){var t;(function(n){var c=function(){function n(n){n!=null&&(this.targetEntityName=n.targetEntityName,this.targetEntityId=n.targetEntityId,this.principalEntityName=n.principalEntityName,this.principalEntityId=n.principalEntityId,this.accessRights=n.accessRights)}return n}(),o,t,s,h,u,f,i,e,r;n.AccessOptions=c;o=function(){function n(n){n!=null?(this.id=n.id!=null?n.id:"00000000-0000-0000-0000-000000000000",this.logicalName=n.logicalName,this.attributes=n.attributes!=null&&n.attributes!=undefined?n.attributes:{}):(this.id="00000000-0000-0000-0000-000000000000",this.attributes={})}return n.prototype.serialize=function(){var n=["<b:value i:type='a:Entity'>"],e,o,i,y,v,p,f,w;n.push('<a:Attributes xmlns:b="http://schemas.datacontract.org/2004/07/System.Collections.Generic">');e=this.attributes;for(o in e)if(e.hasOwnProperty(o)){if(i=e[o],n.push("<a:KeyValuePairOfstringanyType>"),n.push("<b:key>",o,"<\/b:key>"),i===null||i.value===null)n.push("<b:value i:nil='true' />");else{var s=i.type?t.crmXmlEncode(i.type):typeof i,r=void 0,u=void 0,h=void 0,c=void 0,l=void 0,a=void 0;switch(s){case"OptionSetValue":r=i.hasOwnProperty("value")?i.value:i;u=t.encodeValue(r);n.push("<b:value i:type='a:OptionSetValue'>");n.push("<a:Value>",u,"<\/a:Value>","<\/b:value>");break;case"EntityCollection":for(n.push("<b:value i:type='a:EntityCollection'>"),n.push("<a:Entities>"),r=i.hasOwnProperty("value")?i.value:i,y=t.isArray(r)?r:[r],v=0,p=y.length;v<p;v++)f=y[v],h=f.hasOwnProperty("id")?f.id:f,c=t.encodeValue(h),l=f.hasOwnProperty("logicalName")?f.logicalName:f,a=t.encodeValue(l),n.push("<a:Entity>"),n.push("<a:Attributes>"),n.push("<a:KeyValuePairOfstringanyType>"),n.push("<b:key>partyid<\/b:key>"),n.push("<b:value i:type='a:EntityReference'>"),n.push("<a:Id>",c,"<\/a:Id>"),n.push("<a:LogicalName>",a,"<\/a:LogicalName>"),n.push("<a:Name i:nil='true' />"),n.push("<\/b:value>"),n.push("<\/a:KeyValuePairOfstringanyType>"),n.push("<\/a:Attributes>"),n.push("<a:EntityState i:nil='true' />"),n.push("<a:FormattedValues />"),n.push("<a:Id>00000000-0000-0000-0000-000000000000<\/a:Id>"),n.push("<a:LogicalName>activityparty<\/a:LogicalName>"),n.push("<a:RelatedEntities />"),n.push("<\/a:Entity>");n.push("<\/a:Entities>");n.push("<a:EntityName i:nil='true' />");n.push("<a:MinActiveRowVersion i:nil='true' />");n.push("<a:MoreRecords>false<\/a:MoreRecords>");n.push("<a:PagingCookie i:nil='true' />");n.push("<a:TotalRecordCount>0<\/a:TotalRecordCount>");n.push("<a:TotalRecordCountLimitExceeded>false<\/a:TotalRecordCountLimitExceeded>");n.push("<\/b:value>");break;case"EntityReference":h=i.hasOwnProperty("id")?i.id:i;c=t.encodeValue(h);l=i.hasOwnProperty("logicalName")?i.logicalName:i;a=t.encodeValue(l);n.push("<b:value i:type='a:EntityReference'>");n.push("<a:Id>",c,"<\/a:Id>");n.push("<a:LogicalName>",a,"<\/a:LogicalName>");n.push("<a:Name i:nil='true' />","<\/b:value>");break;case"Money":r=i.hasOwnProperty("value")?i.value:i;u=t.encodeValue(r);n.push("<b:value i:type='a:Money'>");n.push("<a:Value>",u,"<\/a:Value>","<\/b:value>");break;case"guid":r=i.hasOwnProperty("value")?i.value:i;u=t.encodeValue(r);n.push("<b:value i:type='c:guid' xmlns:c='http://schemas.microsoft.com/2003/10/Serialization/'>");n.push(u,"<\/b:value>");break;case"number":r=i.hasOwnProperty("value")?i.value:i;u=t.encodeValue(r);w=parseInt(u)===u?"c:int":"c:decimal";n.push("<b:value i:type='",w,"' xmlns:c='http://www.w3.org/2001/XMLSchema'>");n.push(u,"<\/b:value>");break;default:r=i.hasOwnProperty("value")?i.value:i;u=t.encodeValue(r);s=typeof r=="object"&&r.getTime?"dateTime":s;n.push("<b:value i:type='c:",s,"' xmlns:c='http://www.w3.org/2001/XMLSchema'>",u,"<\/b:value>")}}n.push("<\/a:KeyValuePairOfstringanyType>")}return n.push("<\/a:Attributes><a:EntityState i:nil='true' />"),n.push("<a:FormattedValues xmlns:b='http://schemas.datacontract.org/2004/07/System.Collections.Generic' />"),n.push("<a:Id>",t.encodeValue(this.id),"<\/a:Id>"),n.push("<a:LogicalName>",this.logicalName,"<\/a:LogicalName>"),n.push("<a:RelatedEntities xmlns:b='http://schemas.datacontract.org/2004/07/System.Collections.Generic' />"),n.push("<\/b:value>"),n.join("")},n.prototype.deserialize=function(n){for(var o,y,it,k,lt,rt,ut,s,c,ft,h,u,d,l,a,at,et,vt,p,yt,ot,g,pt,w,wt,b,st,nt,bt,ht,v={},ct=n.childNodes,tt=0,kt=ct.length;tt<kt;tt++){o=void 0;y=ct[tt];switch(y.nodeName){case"a:Attributes":for(it=y,k=0,lt=it.childNodes.length;k<lt;k++){rt=it.childNodes[k];ut=rt.childNodes;o=t.getNodeText(ut[0]);s=ut[1];c=s.attributes.getNamedItem("i:type").value;c.replace("c:","").replace("a:","")==="AliasedValue"&&(ft=s.childNodes[2],c=ft.attributes.getNamedItem("i:type").value,s=ft);h=void 0;u=void 0;switch(c){case"a:OptionSetValue":d=new e;d.type=c.replace("a:","");d.value=parseInt(t.getNodeText(s));v[o]=d;break;case"a:EntityReference":if(h=new i,h.type=c.replace("a:",""),l=s.childNodes,l!=null)for(a=0;a<l.length;a++){at=l[a].nodeName;switch(at){case"a:Id":h.id=t.getNodeText(l[a]);break;case"a:LogicalName":h.logicalName=t.getNodeText(l[a]);break;case"a:Name":h.name=t.getNodeText(l[a])}}v[o]=h;break;case"a:EntityCollection":for(h=new f,h.type=c.replace("a:",""),et=[],vt=s.childNodes,p=0,yt=vt[0].childNodes.length;p<yt;p++)for(ot=rt.childNodes[1].childNodes[0].childNodes[p].childNodes[0].childNodes,g=0,pt=ot.length;g<pt;g++)w=ot[g].childNodes,wt=t.getNodeText(w[0]),wt==="partyid"&&(b=new i,b.id=t.getNodeText(w[1].childNodes[0]),b.logicalName=t.getNodeText(w[1].childNodes[1]),b.name=t.getNodeText(w[1].childNodes[2]),et[p]=b);h.value=et;v[o]=h;break;case"a:Money":u=new r;u.type=c.replace("a:","");u.value=parseFloat(t.getNodeText(s));v[o]=u;break;default:u=new r;u.type=c.replace("c:","").replace("a:","");u.value=u.type==="int"?parseInt(t.getNodeText(s)):u.type==="decimal"||u.type==="double"?parseFloat(t.getNodeText(s)):u.type==="dateTime"?t.stringToDate(t.getNodeText(s)):u.type==="boolean"?t.getNodeText(s)==="false"?!1:!0:t.getNodeText(s);v[o]=u}}this.attributes=v;break;case"a:Id":this.id=t.getNodeText(y);break;case"a:LogicalName":this.logicalName=t.getNodeText(y);break;case"a:FormattedValues":for(st=y,nt=0,bt=st.childNodes.length;nt<bt;nt++)ht=st.childNodes[nt],o=t.getNodeText(ht.childNodes[0]),this.attributes[o].formattedValue=t.getNodeText(ht.childNodes[1]),isNaN(this.attributes[o].value)&&this.attributes[o].type==="dateTime"&&(this.attributes[o].value=new Date(this.attributes[o].formattedValue))}}},n}();n.BusinessEntity=o;t=function(){function n(){}return n.alertMessage=function(n){Xrm.Utility!==undefined&&Xrm.Utility.alertDialog!==undefined?Xrm.Utility.alertDialog(n):alert(n)},n.crmXmlDecode=function(n){return"undefined"==typeof n||"unknown"==typeof n||null===n?n:(typeof n!="string"&&(n=n.toString()),n)},n.crmXmlEncode=function(t){return"undefined"==typeof t||"unknown"==typeof t||null===t?t:(typeof t!="string"&&(t=t.toString()),n.innerSurrogateAmpersandWorkaround(t))},n.dateReviver=function(n,t){var i;return typeof t=="string"&&(i=/Date\(([-+]?\d+)\)/.exec(t),i)?new Date(parseInt(t.replace("/Date(","").replace(")/",""),10)):t},n.encodeDate=function(t){return t.getFullYear()+"-"+n.padNumber(t.getMonth()+1)+"-"+n.padNumber(t.getDate())+"T"+n.padNumber(t.getHours())+":"+n.padNumber(t.getMinutes())+":"+n.padNumber(t.getSeconds())},n.encodeValue=function(t){return typeof t=="string"&&t.slice(0,1)==="{"&&t.slice(-1)==="}"&&(t=t.slice(1,-1)),typeof t=="object"&&t.getTime?n.encodeDate(t):n.crmXmlEncode(t)},n.getNodeName=function(n){return typeof n.baseName!="undefined"?n.baseName:n.localName},n.getNodeText=function(n){return typeof n.text!="undefined"?n.text:n.textContent},n.htmlEncode=function(n){var i,r,t;if(n===null||n===""||n===undefined)return n;i="";r="";for(var f=0,u=0,e=n.length;u<e;u++)t=n.charCodeAt(u),i+=t>96&&t<123||t>64&&t<91||t===32||t>47&&t<58||t===46||t===44||t===45||t===95?String.fromCharCode(t):"&#"+t+";",++f==500&&(r+=i,i="",f=0);return i.length&&(r+=i),r},n.innerSurrogateAmpersandWorkaround=function(t){for(var u="",i,e,r=0,f=t.length;r<f;r++)i=t.charCodeAt(r),i>=55296&&i<=57343?r+1<t.length?(e=t.charCodeAt(r+1),e>=56320&&e<=57343?(u+=["CRMEntityReferenceOpen",((i-55296)*1024+(e&1023)+65536).toString(16),"CRMEntityReferenceClose"].join(""),r++):u+=String.fromCharCode(i)):u+=String.fromCharCode(i):u+=String.fromCharCode(i);for(t=u,u="",r=0,f=t.length;r<f;r++)i=t.charCodeAt(r),u+=i>=55296&&i<=57343?String.fromCharCode(65533):String.fromCharCode(i);return t=u,t=n.htmlEncode(t),t=t.replace(/CRMEntityReferenceOpen/g,"&#x"),t.replace(/CRMEntityReferenceClose/g,";")},n.isArray=function(n){return n.constructor.toString().indexOf("Array")!==-1},n.joinArray=function(n,t,i){for(var u=[],r=0,f=t.length;r<f;r++)t[r]!==""&&t[r]!=undefined&&u.push(n,t[r],i);return u.join("")},n.joinConditionPair=function(t,i){for(var r,e,o,f=[],u=0,s=t.length;u<s;u++)if(t[u]!=="")if(r=i[u],typeof r==typeof[]){f.push("<condition attribute='",t[u],"' operator='in' >");for(e in r)r.hasOwnProperty(e)&&(o=n.encodeValue(r[e]),f.push("<value>"+o+"<\/value>"));f.push("<\/condition>")}else typeof r=="string"&&f.push("<condition attribute='",t[u],"' operator='eq' value='",n.encodeValue(r),"' />");return f.join("")},n.padNumber=function(n,t){for(t===void 0&&(t=2),n=""+n;n.length<t;)n="0"+n;return n},n.setClientUrl=function(t){n.clientBaseUrl=t},n.stringToDate=function(n){var t=n.split(/\D/);return new Date(Date.UTC(t[0],--t[1],t[2],t[3],t[4],t[5]))},n.xrmContext=function(){var t,i,r;if(n.clientBaseUrl==="")if(i=window,typeof i.GetGlobalContext!="undefined")t=i.GetGlobalContext();else if(typeof GetGlobalContext!="undefined")t=GetGlobalContext();else if(r=window.parent,typeof Xrm!="undefined")t=Xrm.Page.context;else if(typeof r.Xrm!="undefined")t=r.Xrm.Page.context;else throw new Error("Context is not available.");else t=new u,t.getClientUrl=function(){return n.clientBaseUrl};return t},n.clientBaseUrl="",n}();n.Helper=t;s=function(){function n(){}return n}();n.KeyValuePair=s;h=function(){function n(n){n!=null&&(this.entityName=n.entityName,this.attributes=n.attributes,this.values=n.values,this.columnSet=n.columnSet,this.orderBy=n.orderBy)}return n}();n.QueryOptions=h;u=function(){function n(){}return n.prototype.getClientUrl=function(){return"Not implemented yet."},n.prototype.getCurrentTheme=function(){return"Not implemented yet."},n.prototype.getIsAutoSaveEnabled=function(){return!1},n.prototype.getOrgLcid=function(){return 1033},n.prototype.getOrgUniqueName=function(){return"Not implemented yet."},n.prototype.getQueryStringParameters=function(){return[]},n.prototype.getUserId=function(){return"Not implemented yet."},n.prototype.getUserLcid=function(){return 1033},n.prototype.getUserName=function(){return null},n.prototype.getUserRoles=function(){return[]},n.prototype.prependOrgName=function(){return"Not implemented yet."},n}();n.XrmContext=u;f=function(){function n(n){this.type="EntityCollection";n!=null&&(this.value=n.value)}return n}();n.XrmEntityCollection=f;i=function(){function n(n){n!=null?(this.id=n.id,this.logicalName=n.logicalName,this.name=n.name,this.type=n.type!=null?n.type:"EntityReference"):this.type="EntityReference"}return n}();n.XrmEntityReference=i;e=function(){function n(n){this.type="OptionSetValue";n!=null&&(this.value=n.value,this.formattedValue=n.formattedValue,this.type=n.type!=null?n.type:"OptionSetValue")}return n}();n.XrmOptionSetValue=e;r=function(){function n(n){n!=null&&(this.type=n.type,this.value=n.value)}return n}();n.XrmValue=r})(t=n.Common||(n.Common={}))})(t=n.XrmServiceToolkit||(n.XrmServiceToolkit={}))})(ngXrm||(ngXrm={})),function(n){var t;(function(n){var t;(function(n){var t;(function(n){var i=function(){function n(n){this.requestUrl=n.requestUrl;this.httpConfig=n.httpConfig}return n}(),t;n.RestGet=i;t=function(){function n(n){this.requestUrl=n.requestUrl;this.object=n.object;this.httpConfig=n.httpConfig}return n}();n.RestPost=t})(t=n.Rest||(n.Rest={}))})(t=n.Common||(n.Common={}))})(t=n.XrmServiceToolkit||(n.XrmServiceToolkit={}))}(ngXrm||(ngXrm={})),function(n){var t;(function(t){var i;(function(t){var i=n.XrmServiceToolkit.Common,r=function(){function n(n){this.$http=n;this.arrayElements=["Attributes","ManyToManyRelationships","ManyToOneRelationships","OneToManyRelationships","Privileges","LocalizedLabels","Options","Targets"]}return n.prototype.__isMetadataArray=function(n){for(var i=this,t=0,r=i.arrayElements.length;t<r;t++)if(n===i.arrayElements[t])return!0;return!1},n.prototype.__isNodeNull=function(n){return n==null?!0:n.attributes.getNamedItem("i:nil")!=null&&n.attributes.getNamedItem("i:nil").value==="true"?!0:!1},n.prototype.__nsResolver=function(n){return{s:"http://schemas.xmlsoap.org/soap/envelope/",a:"http://schemas.microsoft.com/xrm/2011/Contracts",i:"http://www.w3.org/2001/XMLSchema-instance",b:"http://schemas.datacontract.org/2004/07/System.Collections.Generic",c:"http://schemas.microsoft.com/xrm/2011/Metadata",ser:"http://schemas.microsoft.com/xrm/2011/Contracts/Services"}[n]||null},n.prototype.__objectifyNode=function(n){var f=this,h,e,t,c,o,s,u,r,l;if(n.attributes!=null&&n.attributes.length===1&&n.attributes.getNamedItem("i:nil")!=null&&n.attributes.getNamedItem("i:nil").nodeValue==="true")return null;if(n.firstChild!=null&&n.firstChild.nodeType===3){h=i.Helper.getNodeName(n);switch(h){case"ActivityTypeMask":case"ObjectTypeCode":case"ColumnNumber":case"DefaultFormValue":case"MaxValue":case"MinValue":case"MaxLength":case"Order":case"Precision":case"PrecisionSource":case"LanguageCode":return parseInt(n.firstChild.nodeValue,10);case"AutoRouteToOwnerQueue":case"CanBeChanged":case"CanTriggerWorkflow":case"IsActivity":case"IsActivityParty":case"IsAvailableOffline":case"IsChildEntity":case"IsCustomEntity":case"IsCustomOptionSet":case"IsDocumentManagementEnabled":case"IsEnabledForCharts":case"IsGlobal":case"IsImportable":case"IsIntersect":case"IsManaged":case"IsReadingPaneEnabled":case"IsValidForAdvancedFind":case"CanBeSecuredForCreate":case"CanBeSecuredForRead":case"CanBeSecuredForUpdate":case"IsCustomAttribute":case"IsPrimaryId":case"IsPrimaryName":case"IsSecured":case"IsValidForCreate":case"IsValidForRead":case"IsValidForUpdate":case"IsCustomRelationship":case"CanBeBasic":case"CanBeDeep":case"CanBeGlobal":case"CanBeLocal":return n.firstChild.nodeValue==="true"?!0:!1;case"Value":return n.firstChild.nodeValue==="true"||n.firstChild.nodeValue==="false"?n.firstChild.nodeValue==="true"?!0:!1:n.firstChild.nodeValue==="ApplicationRequired"||n.firstChild.nodeValue==="None"||n.firstChild.nodeValue==="Recommended"||n.firstChild.nodeValue==="SystemRequired"?n.firstChild.nodeValue:parseInt(n.firstChild.nodeValue,10);default:return n.firstChild.nodeValue}}if(f.__isMetadataArray(i.Helper.getNodeName(n))){for(e=[],t=0,c=n.childNodes.length;t<c;t++)o=void 0,o=n.childNodes[t].attributes!=null&&n.childNodes[t].attributes.getNamedItem("i:type")!=null?n.childNodes[t].attributes.getNamedItem("i:type").nodeValue.split(":")[1]:i.Helper.getNodeName(n.childNodes[t]),s=f.__objectifyNode(n.childNodes[t]),s._type=o,e.push(s);return e}if(n.childNodes.length===0)return null;for(u={},n.attributes.getNamedItem("i:type")!=null&&(u._type=n.attributes.getNamedItem("i:type").nodeValue.split(":")[1]),r=0,l=n.childNodes.length;r<l;r++)u[i.Helper.getNodeName(n.childNodes[r])]=n.childNodes[r].nodeType===3?n.childNodes[r].nodeValue:f.__objectifyNode(n.childNodes[r]);return u},n.prototype.__orgServicePath=function(n){var t=this;return[n.getClientUrl(),"/XRMServices/2011/Organization.svc/web"].join("")},n.prototype.__selectNodes=function(n,t){var f=this;if(typeof n.selectNodes!="undefined")return n.selectNodes(t);for(var r=[],u=n.evaluate(t,n,f.__nsResolver,XPathResult.ANY_TYPE,null),i=u.iterateNext();i;)r.push(i),i=u.iterateNext();return r},n.prototype.__selectSingleNode=function(n,t){var u=this,i,r;return typeof n.selectSingleNode!="undefined"?n.selectSingleNode(t):(i=new XPathEvaluator,r=i.evaluate(t,n,{lookupNamespaceURI:u.__nsResolver},XPathResult.FIRST_ORDERED_NODE_TYPE,null),r.singleNodeValue)},n.prototype.__selectSingleNodeText=function(n,t){var r=this,i=r.__selectSingleNode(n,t);return r.__isNodeNull(i)?null:typeof i.text!="undefined"?i.text:i.textContent},n.prototype.__setSelectionNamespaces=function(n){n.setProperty("SelectionNamespaces","xmlns:s='http://schemas.xmlsoap.org/soap/envelope/' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts' xmlns:i='http://www.w3.org/2001/XMLSchema-instance' xmlns:b='http://schemas.datacontract.org/2004/07/System.Collections.Generic' xmlns:c='http://schemas.microsoft.com/xrm/2011/Metadata' xmlns:ser='http://schemas.microsoft.com/xrm/2011/Contracts/Services'")},n.prototype.__xmlParser=function(n){var t=null,u=Window,r;try{t=new ActiveXObject("Microsoft.XMLDOM");t.async=!1;t.loadXML(n)}catch(f){u.DOMParser?(r=new DOMParser,t=r.parseFromString(n,"text/xml")):i.Helper.alertMessage("Cannot convert the XML string to a cross-browser XML object.")}return t},n.prototype.__xmlToString=function(n){var r=this,t="";try{n!=null&&(typeof XMLSerializer!="undefined"&&typeof n.xml=="undefined"?t=(new XMLSerializer).serializeToString(n):typeof n.xml!="undefined"?t=n.xml:typeof n[0].xml!="undefined"&&(t=n[0].xml))}catch(u){i.Helper.alertMessage("Cannot convert the XML to a string.")}return t},n.prototype._doRequest=function(n,t){var r=this,u=["<soap:Envelope xmlns:soap='http://schemas.xmlsoap.org/soap/envelope/'>","<soap:Body>","<",t," xmlns='http://schemas.microsoft.com/xrm/2011/Contracts/Services' xmlns:i='http://www.w3.org/2001/XMLSchema-instance'>",n,"<\/",t,">","<\/soap:Body>","<\/soap:Envelope>"].join(""),f={headers:{Accept:"application/xml, text/xml, */*","Content-Type":"text/xml; charset=utf-8",SOAPAction:"http://schemas.microsoft.com/xrm/2011/Contracts/Services/IOrganizationService/"+t}};try{return r.$http.post(r.__orgServicePath(i.Helper.xrmContext()),u,f).then(function(n){var t=r.__xmlParser(n.data);try{r.__setSelectionNamespaces(t)}catch(i){}return t}).catch(function(n){return Q.reject(n)})}catch(e){return Q.reject(e)}},n.prototype.createEntity=function(n){var t=this,r=n.serialize(),u=["<request i:type='a:CreateRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts'>","<a:Parameters xmlns:b='http://schemas.datacontract.org/2004/07/System.Collections.Generic'>","<a:KeyValuePairOfstringanyType>","<b:key>Target<\/b:key>",r,"<\/a:KeyValuePairOfstringanyType>","<\/a:Parameters>","<a:RequestId i:nil='true' />","<a:RequestName>Create<\/a:RequestName>","<\/request>"].join("");return t._doRequest(u,"Execute").then(function(n){var r=t.__selectSingleNodeText(n,"//b:value");return i.Helper.crmXmlDecode(r)})},n.prototype.updateEntity=function(n){var t=this,r=n.serialize(),u=["<request i:type='a:UpdateRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts'>","<a:Parameters xmlns:b='http://schemas.datacontract.org/2004/07/System.Collections.Generic'>","<a:KeyValuePairOfstringanyType>","<b:key>Target<\/b:key>",r,"<\/a:KeyValuePairOfstringanyType>","<\/a:Parameters>","<a:RequestId i:nil='true' />","<a:RequestName>Update<\/a:RequestName>","<\/request>"].join("");return t._doRequest(u,"Execute").then(function(n){var r=t.__selectSingleNodeText(n,"//a:Results");return i.Helper.crmXmlDecode(r)})},n.prototype.deleteEntity=function(n,t){var r=this,u=["<request i:type='a:DeleteRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts'><a:Parameters xmlns:b='http://schemas.datacontract.org/2004/07/System.Collections.Generic'><a:KeyValuePairOfstringanyType><b:key>Target<\/b:key><b:value i:type='a:EntityReference'><a:Id>",t,"<\/a:Id><a:LogicalName>",n,"<\/a:LogicalName><a:Name i:nil='true' /><\/b:value><\/a:KeyValuePairOfstringanyType><\/a:Parameters><a:RequestId i:nil='true' /><a:RequestName>Delete<\/a:RequestName><\/request>"].join("");return r._doRequest(u,"Execute").then(function(n){var t=r.__selectSingleNodeText(n,"//a:Results");return i.Helper.crmXmlDecode(t)})},n.prototype.execute=function(n){var t=this;return t._doRequest(n,"Execute").then(function(n){return n})},n.prototype._doFetch=function(n,t,r){var e=this,u=n,f;return t>1&&(u=["<fetch mapping='logical' page='"+t.toString()+"' count='5000' paging-cookie='"+r+"'>",n.replace(/\"/g,"'"),"<\/fetch>"].join("")),f=["<request i:type='a:RetrieveMultipleRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts'>","<a:Parameters xmlns:b='http://schemas.datacontract.org/2004/07/System.Collections.Generic'>","<a:KeyValuePairOfstringanyType>","<b:key>Query<\/b:key>","<b:value i:type='a:FetchExpression'>","<a:Query>",i.Helper.crmXmlEncode(u),"<\/a:Query>","<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<\/a:Parameters>","<a:RequestId i:nil='true'/>","<a:RequestName>RetrieveMultiple<\/a:RequestName>","<\/request>"].join(""),e._doRequest(f,"Execute").then(function(n){return n}).catch(function(n){return Q.reject(n)})},n.prototype.fetch=function(n,t,r){var u=this,e=Q.defer(),o=n,l=r!=null?r:-1,f;if(n.slice(0,7)==="<entity")o=["<fetch mapping='logical'>",n.replace(/\"/g,"'"),"<\/fetch>"].join("");else{var p=n.indexOf("aggregate=")!==-1,w=n.indexOf("page='1'")!==-1&&n.indexOf("count='")!==-1,s=n.indexOf("distinct="),a=s!==-1,b=n.substring(s+9,s+10),k=a?n.substring(n.indexOf("distinct=")+10,n.indexOf(b,n.indexOf("distinct=")+10)):"false",d=u.__xmlParser(n),v=u.__selectSingleNode(d,"//entity");v===null&&Q.reject("XrmServiceToolkit.Fetch: No 'entity' node in the provided FetchXML.");f=v;try{n=u.__xmlToString(f).replace(/\"/g,"'")}catch(g){f!==undefined&&f.xml?n=f.xml.replace(/\"/g,"'"):Q.reject("XrmServiceToolkit.Fetch: This client does not provide the necessary XML features to continue.")}p||w||(o=["<fetch mapping='logical' distinct='"+(a?k:"false")+"' >",n,"<\/fetch>"].join(""))}var h=1,c=[],y=function(r){var f,a,o,v,s,p;if(r!=null&&(f=u.__selectSingleNode(r,"//a:Entities"),a=u.__selectSingleNodeText(r,"//a:MoreRecords")==="true",f!=null)){for(o=0,v=f.childNodes.length;o<v;o++)s=new i.BusinessEntity,s.deserialize(f.childNodes[o]),c.push(s);t&&a&&(l===-1||c.length<=l)?(p=u.__selectSingleNodeText(r,"//a:PagingCookie").replace(/\"/g,"'").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&quot;"),h+=1,u._doFetch(n,h,p).then(y).catch(function(n){return e.reject(n)})):e.resolve(c)}};return u._doFetch(o,h,null).then(y).catch(function(n){return e.reject(n)}),e.promise},n.prototype.retrieveEntity=function(n,t,r){var e=this,o="",f="",u,s,h;if(r!=null){for(u=0,s=r.length;u<s;u++)o+="<c:string>"+r[u]+"<\/c:string>";f="<a:AllColumns>false<\/a:AllColumns><a:Columns xmlns:c='http://schemas.microsoft.com/2003/10/Serialization/Arrays'>"+o+"<\/a:Columns>"}else f="<a:AllColumns>true<\/a:AllColumns><a:Columns xmlns:b='http://schemas.microsoft.com/2003/10/Serialization/Arrays' />";return h=["<request i:type='a:RetrieveRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts'>","<a:Parameters xmlns:b='http://schemas.datacontract.org/2004/07/System.Collections.Generic'>","<a:KeyValuePairOfstringanyType>","<b:key>Target<\/b:key>","<b:value i:type='a:EntityReference'>","<a:Id>",i.Helper.encodeValue(t),"<\/a:Id>","<a:LogicalName>",n,"<\/a:LogicalName>","<a:Name i:nil='true' />","<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<b:key>ColumnSet<\/b:key>","<b:value i:type='a:ColumnSet'>",f,"<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<\/a:Parameters>","<a:RequestId i:nil='true' />","<a:RequestName>Retrieve<\/a:RequestName>","<\/request>"].join(""),e._doRequest(h,"Execute").then(function(n){var r=e.__selectSingleNode(n,"//b:value"),t=new i.BusinessEntity;return t.deserialize(r),t})},n.prototype.retrieveMultiple=function(n){var t=this,r=["<request i:type='a:RetrieveMultipleRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts'>","<a:Parameters xmlns:b='http://schemas.datacontract.org/2004/07/System.Collections.Generic'>","<a:KeyValuePairOfstringanyType>","<b:key>Query<\/b:key>","<b:value i:type='a:QueryExpression'>",n,"<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<\/a:Parameters>","<a:RequestId i:nil='true'/>","<a:RequestName>RetrieveMultiple<\/a:RequestName>","<\/request>"].join("");return t._doRequest(r,"Execute").then(function(n){for(var u,f=t.__selectSingleNode(n,"//a:Entities"),e=[],r=0,o=f.childNodes.length;r<o;r++)u=new i.BusinessEntity,u.deserialize(f.childNodes[r]),e[r]=u;return e})},n.prototype._doQueryByAttribute=function(n,t,r){var f=this,u;return n.entityName===undefined||n.entityName===""||n.columnSet===undefined||n.columnSet.length===0||n.attributes===undefined||n.attributes.length===0||n.values===undefined||n.values.length===0?Q.reject("QueryOptions are invalid."):n.attributes.length!==n.values.length?Q.reject("The number of values must match the number of attributes provided."):(u=["<entity name='",n.entityName,"'>",i.Helper.joinArray("<attribute name='",n.columnSet,"' />"),i.Helper.joinArray("<order attribute='",n.orderBy||[""],"' />"),"<filter>",i.Helper.joinConditionPair(n.attributes,n.values),"<\/filter>","<\/entity>"].join(""),f.fetch(u,t,r))},n.prototype.queryByAttribute=function(n){var t=this;return t._doQueryByAttribute(n,!1)},n.prototype.queryAllByAttribute=function(n,t){var i=this;return i._doQueryByAttribute(n,!0,t)},n.prototype.setState=function(n,t,r,u){var f=this,e=["<request i:type='b:SetStateRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts' xmlns:b='http://schemas.microsoft.com/crm/2011/Contracts'>","<a:Parameters xmlns:c='http://schemas.datacontract.org/2004/07/System.Collections.Generic'>","<a:KeyValuePairOfstringanyType>","<c:key>EntityMoniker<\/c:key>","<c:value i:type='a:EntityReference'>","<a:Id>",i.Helper.encodeValue(t),"<\/a:Id>","<a:LogicalName>",n,"<\/a:LogicalName>","<a:Name i:nil='true' />","<\/c:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<c:key>State<\/c:key>","<c:value i:type='a:OptionSetValue'>","<a:Value>",r.toString(),"<\/a:Value>","<\/c:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<c:key>Status<\/c:key>","<c:value i:type='a:OptionSetValue'>","<a:Value>",u.toString(),"<\/a:Value>","<\/c:value>","<\/a:KeyValuePairOfstringanyType>","<\/a:Parameters>","<a:RequestId i:nil='true' />","<a:RequestName>SetState<\/a:RequestName>","<\/request>"].join("");return f._doRequest(e,"Execute").then(function(n){var t=f.__selectSingleNodeText(n,"//ser:ExecuteResult");return i.Helper.crmXmlDecode(t)})},n.prototype.associate=function(n,t,r,u,f){for(var c,l,s=this,o=f,h=[],e=0,a=o.length;e<a;e++)o[e].id!==""&&h.push("<a:EntityReference>","<a:Id>",o[e].id,"<\/a:Id>","<a:LogicalName>",u,"<\/a:LogicalName>","<a:Name i:nil='true' />","<\/a:EntityReference>");return c=h.join(""),l=["<request i:type='a:AssociateRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts'>","<a:Parameters xmlns:b='http://schemas.datacontract.org/2004/07/System.Collections.Generic'>","<a:KeyValuePairOfstringanyType>","<b:key>Target<\/b:key>","<b:value i:type='a:EntityReference'>","<a:Id>",i.Helper.encodeValue(r),"<\/a:Id>","<a:LogicalName>",t,"<\/a:LogicalName>","<a:Name i:nil='true' />","<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<b:key>Relationship<\/b:key>","<b:value i:type='a:Relationship'>","<a:PrimaryEntityRole>Referenced<\/a:PrimaryEntityRole>","<a:SchemaName>",n,"<\/a:SchemaName>","<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<b:key>RelatedEntities<\/b:key>","<b:value i:type='a:EntityReferenceCollection'>",c,"<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<\/a:Parameters>","<a:RequestId i:nil='true' />","<a:RequestName>Associate<\/a:RequestName>","<\/request>"].join(""),s._doRequest(l,"Execute").then(function(n){var t=s.__selectSingleNodeText(n,"//ser:ExecuteResult");return i.Helper.crmXmlDecode(t)})},n.prototype.disassociate=function(n,t,r,u,f){for(var c,l,s=this,o=f,h=[],e=0,a=o.length;e<a;e++)o[e].id!==""&&h.push("<a:EntityReference>","<a:Id>",o[e].id,"<\/a:Id>","<a:LogicalName>",u,"<\/a:LogicalName>","<a:Name i:nil='true' />","<\/a:EntityReference>");return c=h.join(""),l=["<request i:type='a:DisassociateRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts'>","<a:Parameters xmlns:b='http://schemas.datacontract.org/2004/07/System.Collections.Generic'>","<a:KeyValuePairOfstringanyType>","<b:key>Target<\/b:key>","<b:value i:type='a:EntityReference'>","<a:Id>",i.Helper.encodeValue(r),"<\/a:Id>","<a:LogicalName>",t,"<\/a:LogicalName>","<a:Name i:nil='true' />","<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<b:key>Relationship<\/b:key>","<b:value i:type='a:Relationship'>","<a:PrimaryEntityRole i:nil='true' />","<a:SchemaName>",n,"<\/a:SchemaName>","<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<b:key>RelatedEntities<\/b:key>","<b:value i:type='a:EntityReferenceCollection'>",c,"<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<\/a:Parameters>","<a:RequestId i:nil='true' />","<a:RequestName>Disassociate<\/a:RequestName>","<\/request>"].join(""),s._doRequest(l,"Execute").then(function(n){var t=s.__selectSingleNodeText(n,"//ser:ExecuteResult");return i.Helper.crmXmlDecode(t)})},n.prototype.getCurrentUserId=function(){var n=this,t="<request i:type='b:WhoAmIRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts' xmlns:b='http://schemas.microsoft.com/crm/2011/Contracts'><a:Parameters xmlns:c='http://schemas.datacontract.org/2004/07/System.Collections.Generic' /><a:RequestId i:nil='true' /><a:RequestName>WhoAmI<\/a:RequestName><\/request>";return n._doRequest(t,"Execute").then(function(t){return i.Helper.getNodeText(n.__selectNodes(t,"//b:value")[0])})},n.prototype.getCurrentUserBusinessUnitId=function(){var n=this,t="<request i:type='b:WhoAmIRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts' xmlns:b='http://schemas.microsoft.com/crm/2011/Contracts'><a:Parameters xmlns:c='http://schemas.datacontract.org/2004/07/System.Collections.Generic' /><a:RequestId i:nil='true' /><a:RequestName>WhoAmI<\/a:RequestName><\/request>";return n._doRequest(t,"Execute").then(function(t){return i.Helper.getNodeText(n.__selectNodes(t,"//b:value")[1])})},n.prototype.getCurrentUserRoles=function(){var n=this,t="<fetch version='1.0' output-format='xml-platform' mapping='logical' distinct='true'><entity name='role'><attribute name='name' /><attribute name='businessunitid' /><attribute name='roleid' /><order attribute='name' descending='false' /><link-entity name='systemuserroles' from='roleid' to='roleid' visible='false' intersect='true'><link-entity name='systemuser' from='systemuserid' to='systemuserid' alias='aa'><filter type='and'><condition attribute='systemuserid' operator='eq-userid' /><\/filter><\/link-entity><\/link-entity><\/entity><\/fetch>";return n.fetch(t,!0).then(function(n){var i=[],t,r;if(n!==null&&typeof n!="undefined")for(t=0,r=n.length;t<r;t++)i.push(n[t].attributes.name.value.toString());return i})},n.prototype.isCurrentUserInRole=function(n){var i=this,t=!1;return(n==null||n==undefined)&&(n=[""]),i.getCurrentUserRoles().then(function(i){var r,u;if(i!=null&&i!=undefined)for(r=0;r<i.length;r++)for(u=0;u<n.length;u++)if(i[r]===n[u]){t=!0;break}return t})},n.prototype.assign=function(n,t,r,u){var f=this,e=["<request i:type='b:AssignRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts' xmlns:b='http://schemas.microsoft.com/crm/2011/Contracts'>","<a:Parameters xmlns:c='http://schemas.datacontract.org/2004/07/System.Collections.Generic'>","<a:KeyValuePairOfstringanyType>","<c:key>Target<\/c:key>","<c:value i:type='a:EntityReference'>","<a:Id>",i.Helper.encodeValue(t),"<\/a:Id>","<a:LogicalName>",n,"<\/a:LogicalName>","<a:Name i:nil='true' />","<\/c:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<c:key>Assignee<\/c:key>","<c:value i:type='a:EntityReference'>","<a:Id>",i.Helper.encodeValue(u),"<\/a:Id>","<a:LogicalName>",r,"<\/a:LogicalName>","<a:Name i:nil='true' />","<\/c:value>","<\/a:KeyValuePairOfstringanyType>","<\/a:Parameters>","<a:RequestId i:nil='true' />","<a:RequestName>Assign<\/a:RequestName>","<\/request>"].join("");return f._doRequest(e,"Execute").then(function(n){var t=f.__selectSingleNodeText(n,"//ser:ExecuteResult");return i.Helper.crmXmlDecode(t)})},n.prototype.grantAccess=function(n){var r,u,t,f,e;if(n.targetEntityName===undefined||n.targetEntityName===""||n.targetEntityId===undefined||n.targetEntityId===""||n.principalEntityName===undefined||n.principalEntityName===""||n.principalEntityId===undefined||n.principalEntityId===""||n.accessRights===undefined||n.accessRights.length===0)throw new Error("AccessOptions are invalid for grantAccess.");for(r=this,u=[],t=0,f=n.accessRights.length;t<f;t++)u.push(i.Helper.encodeValue(n.accessRights[t])+" ");return e=["<request i:type='b:GrantAccessRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts' xmlns:b='http://schemas.microsoft.com/crm/2011/Contracts'>","<a:Parameters xmlns:c='http://schemas.datacontract.org/2004/07/System.Collections.Generic'>","<a:KeyValuePairOfstringanyType>","<c:key>Target<\/c:key>","<c:value i:type='a:EntityReference'>","<a:Id>",i.Helper.encodeValue(n.targetEntityId),"<\/a:Id>","<a:LogicalName>",n.targetEntityName,"<\/a:LogicalName>","<a:Name i:nil='true' />","<\/c:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<c:key>PrincipalAccess<\/c:key>","<c:value i:type='b:PrincipalAccess'>","<b:AccessMask>",u.join(""),"<\/b:AccessMask>","<b:Principal>","<a:Id>",i.Helper.encodeValue(n.principalEntityId),"<\/a:Id>","<a:LogicalName>",n.principalEntityName,"<\/a:LogicalName>","<a:Name i:nil='true' />","<\/b:Principal>","<\/c:value>","<\/a:KeyValuePairOfstringanyType>","<\/a:Parameters>","<a:RequestId i:nil='true' />","<a:RequestName>GrantAccess<\/a:RequestName>","<\/request>"].join(""),r._doRequest(e,"Execute").then(function(n){var t=r.__selectSingleNodeText(n,"//ser:ExecuteResult");return i.Helper.crmXmlDecode(t)})},n.prototype.modifyAccess=function(n){var r,u,t,f,e;if(n.targetEntityName===undefined||n.targetEntityName===""||n.targetEntityId===undefined||n.targetEntityId===""||n.principalEntityName===undefined||n.principalEntityName===""||n.principalEntityId===undefined||n.principalEntityId===""||n.accessRights===undefined||n.accessRights.length===0)throw new Error("AccessOptions are invalid for modifyAccess.");for(r=this,u=[],t=0,f=n.accessRights.length;t<f;t++)u.push(i.Helper.encodeValue(n.accessRights[t])+" ");return e=["<request i:type='b:ModifyAccessRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts' xmlns:b='http://schemas.microsoft.com/crm/2011/Contracts'>","<a:Parameters xmlns:c='http://schemas.datacontract.org/2004/07/System.Collections.Generic'>","<a:KeyValuePairOfstringanyType>","<c:key>Target<\/c:key>","<c:value i:type='a:EntityReference'>","<a:Id>",i.Helper.encodeValue(n.targetEntityId),"<\/a:Id>","<a:LogicalName>",n.targetEntityName,"<\/a:LogicalName>","<a:Name i:nil='true' />","<\/c:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<c:key>PrincipalAccess<\/c:key>","<c:value i:type='b:PrincipalAccess'>","<b:AccessMask>",u.join(""),"<\/b:AccessMask>","<b:Principal>","<a:Id>",i.Helper.encodeValue(n.principalEntityId),"<\/a:Id>","<a:LogicalName>",n.principalEntityName,"<\/a:LogicalName>","<a:Name i:nil='true' />","<\/b:Principal>","<\/c:value>","<\/a:KeyValuePairOfstringanyType>","<\/a:Parameters>","<a:RequestId i:nil='true' />","<a:RequestName>ModifyAccess<\/a:RequestName>","<\/request>"].join(""),r._doRequest(e,"Execute").then(function(n){var t=r.__selectSingleNodeText(n,"//ser:ExecuteResult");return i.Helper.crmXmlDecode(t)})},n.prototype.revokeAccess=function(n){if(n.targetEntityName===undefined||n.targetEntityName===""||n.targetEntityId===undefined||n.targetEntityId===""||n.principalEntityName===undefined||n.principalEntityName===""||n.principalEntityId===undefined||n.principalEntityId==="")throw new Error("AccessOptions are invalid for revokeAccess.");var t=this,r=["<request i:type='b:RevokeAccessRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts' xmlns:b='http://schemas.microsoft.com/crm/2011/Contracts'>","<a:Parameters xmlns:c='http://schemas.datacontract.org/2004/07/System.Collections.Generic'>","<a:KeyValuePairOfstringanyType>","<c:key>Target<\/c:key>","<c:value i:type='a:EntityReference'>","<a:Id>",i.Helper.encodeValue(n.targetEntityId),"<\/a:Id>","<a:LogicalName>",n.targetEntityName,"<\/a:LogicalName>","<a:Name i:nil='true' />","<\/c:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<c:key>Revokee<\/c:key>","<c:value i:type='a:EntityReference'>","<a:Id>",i.Helper.encodeValue(n.principalEntityId),"<\/a:Id>","<a:LogicalName>",n.principalEntityName,"<\/a:LogicalName>","<a:Name i:nil='true' />","<\/c:value>","<\/a:KeyValuePairOfstringanyType>","<\/a:Parameters>","<a:RequestId i:nil='true' />","<a:RequestName>RevokeAccess<\/a:RequestName>","<\/request>"].join("");return t._doRequest(r,"Execute").then(function(n){var r=t.__selectSingleNodeText(n,"//ser:ExecuteResult");return i.Helper.crmXmlDecode(r)})},n.prototype.retrievePrincipalAccess=function(n){if(n.targetEntityName===undefined||n.targetEntityName===""||n.targetEntityId===undefined||n.targetEntityId===""||n.principalEntityName===undefined||n.principalEntityName===""||n.principalEntityId===undefined||n.principalEntityId==="")return Q.reject("AccessOptions are invalid for retrievePrincipalAccess.");var t=this,r=["<request i:type='b:RetrievePrincipalAccessRequest' xmlns:a='http://schemas.microsoft.com/xrm/2011/Contracts' xmlns:b='http://schemas.microsoft.com/crm/2011/Contracts'>","<a:Parameters xmlns:c='http://schemas.datacontract.org/2004/07/System.Collections.Generic'>","<a:KeyValuePairOfstringanyType>","<c:key>Target<\/c:key>","<c:value i:type='a:EntityReference'>","<a:Id>",i.Helper.encodeValue(n.targetEntityId),"<\/a:Id>","<a:LogicalName>",n.targetEntityName,"<\/a:LogicalName>","<a:Name i:nil='true' />","<\/c:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<c:key>Principal<\/c:key>","<c:value i:type='a:EntityReference'>","<a:Id>",i.Helper.encodeValue(n.principalEntityId),"<\/a:Id>","<a:LogicalName>",n.principalEntityName,"<\/a:LogicalName>","<a:Name i:nil='true' />","<\/c:value>","<\/a:KeyValuePairOfstringanyType>","<\/a:Parameters>","<a:RequestId i:nil='true' />","<a:RequestName>RetrievePrincipalAccess<\/a:RequestName>","<\/request>"].join("");return t._doRequest(r,"Execute").then(function(n){var i=t.__selectSingleNodeText(n,"//b:value");return i.split(" ")})},n.prototype.addMemberTeamRequest=function(n,t){var i=this,r=['<request i:type="b:AddMembersTeamRequest" xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts" xmlns:b="http://schemas.microsoft.com/crm/2011/Contracts">','<a:Parameters xmlns:c="http://schemas.datacontract.org/2004/07/System.Collections.Generic">',"<a:KeyValuePairOfstringanyType>","<c:key>TeamId<\/c:key>",'<c:value i:type="d:guid" xmlns:d="http://schemas.microsoft.com/2003/10/Serialization/">',n,"<\/c:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<c:key>MemberIds<\/c:key>",'<c:value i:type="d:ArrayOfguid" xmlns:d="http://schemas.microsoft.com/2003/10/Serialization/Arrays">',"<d:guid>",t,"<\/d:guid>","<\/c:value>","<\/a:KeyValuePairOfstringanyType>","<\/a:Parameters>",'<a:RequestId i:nil="true" />',"<a:RequestName>AddMembersTeam<\/a:RequestName>","<\/request>"].join("");return i._doRequest(r,"Execute").then(function(n){return n})},n.prototype.removeMemberTeamRequest=function(n,t){var i=this,r=['<request i:type="b:RemoveMembersTeamRequest" xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts" xmlns:b="http://schemas.microsoft.com/crm/2011/Contracts">','<a:Parameters xmlns:c="http://schemas.datacontract.org/2004/07/System.Collections.Generic">',"<a:KeyValuePairOfstringanyType>","<c:key>TeamId<\/c:key>",'<c:value i:type="d:guid" xmlns:d="http://schemas.microsoft.com/2003/10/Serialization/">',n,"<\/c:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<c:key>MemberIds<\/c:key>",'<c:value i:type="d:ArrayOfguid" xmlns:d="http://schemas.microsoft.com/2003/10/Serialization/Arrays">',"<d:guid>",t,"<\/d:guid>","<\/c:value>","<\/a:KeyValuePairOfstringanyType>","<\/a:Parameters>",'<a:RequestId i:nil="true" />',"<a:RequestName>RemoveMembersTeam<\/a:RequestName>","<\/request>"].join("");return i._doRequest(r,"Execute").then(function(n){return n})},n.prototype.retrieveAllEntitiesMetadata=function(n,t){for(var o,r=this,f=[],e="",u=0,s=n.length;u<s;u++)e+=i.Helper.encodeValue(n[u])+" ";return o=['<request i:type="a:RetrieveAllEntitiesRequest" xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts">','<a:Parameters xmlns:b="http://schemas.datacontract.org/2004/07/System.Collections.Generic">',"<a:KeyValuePairOfstringanyType>","<b:key>EntityFilters<\/b:key>",'<b:value i:type="c:EntityFilters" xmlns:c="http://schemas.microsoft.com/xrm/2011/Metadata">'+i.Helper.encodeValue(e)+"<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<b:key>RetrieveAsIfPublished<\/b:key>",'<b:value i:type="c:boolean" xmlns:c="http://www.w3.org/2001/XMLSchema">'+i.Helper.encodeValue(t.toString())+"<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<\/a:Parameters>",'<a:RequestId i:nil="true" />',"<a:RequestName>RetrieveAllEntities<\/a:RequestName>","<\/request>"].join(""),r._doRequest(o,"Execute").then(function(n){for(var i,u=r.__selectNodes(n,"//c:EntityMetadata"),t=0,e=u.length;t<e;t++)i=r.__objectifyNode(u[t]),i._type="EntityMetadata",f.push(i);return f})},n.prototype.retrieveEntityMetadata=function(n,t,r){for(var o,u=this,e=[],f=0,s=n.length;f<s;f++)e.push(i.Helper.encodeValue(n[f])+" ");return o=['<request i:type="a:RetrieveEntityRequest" xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts">','<a:Parameters xmlns:b="http://schemas.datacontract.org/2004/07/System.Collections.Generic">',"<a:KeyValuePairOfstringanyType>","<b:key>EntityFilters<\/b:key>",'<b:value i:type="c:EntityFilters" xmlns:c="http://schemas.microsoft.com/xrm/2011/Metadata">',i.Helper.encodeValue(e.join("")),"<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<b:key>MetadataId<\/b:key>",'<b:value i:type="c:guid"  xmlns:c="http://schemas.microsoft.com/2003/10/Serialization/">',i.Helper.encodeValue("00000000-0000-0000-0000-000000000000"),"<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<b:key>RetrieveAsIfPublished<\/b:key>",'<b:value i:type="c:boolean" xmlns:c="http://www.w3.org/2001/XMLSchema">',i.Helper.encodeValue(r.toString()),"<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<b:key>LogicalName<\/b:key>",'<b:value i:type="c:string" xmlns:c="http://www.w3.org/2001/XMLSchema">',i.Helper.encodeValue(t),"<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<\/a:Parameters>",'<a:RequestId i:nil="true" />',"<a:RequestName>RetrieveEntity<\/a:RequestName>","<\/request>"].join(""),u._doRequest(o,"Execute").then(function(n){for(var i,r=u.__selectNodes(n,"//b:value"),f=[],t=0,e=r.length;t<e;t++)i=u.__objectifyNode(r[t]),i._type="EntityMetadata",f.push(i);return f})},n.prototype.retrieveAttributeMetadata=function(n,t,r){var u=this,f=['<request i:type="a:RetrieveAttributeRequest" xmlns:a="http://schemas.microsoft.com/xrm/2011/Contracts">','<a:Parameters xmlns:b="http://schemas.datacontract.org/2004/07/System.Collections.Generic">',"<a:KeyValuePairOfstringanyType>","<b:key>EntityLogicalName<\/b:key>",'<b:value i:type="c:string" xmlns:c="http://www.w3.org/2001/XMLSchema">',i.Helper.encodeValue(n),"<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<b:key>MetadataId<\/b:key>",'<b:value i:type="ser:guid"  xmlns:ser="http://schemas.microsoft.com/2003/10/Serialization/">',i.Helper.encodeValue("00000000-0000-0000-0000-000000000000"),"<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<b:key>RetrieveAsIfPublished<\/b:key>",'<b:value i:type="c:boolean" xmlns:c="http://www.w3.org/2001/XMLSchema">',i.Helper.encodeValue(r.toString()),"<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<a:KeyValuePairOfstringanyType>","<b:key>LogicalName<\/b:key>",'<b:value i:type="c:string"   xmlns:c="http://www.w3.org/2001/XMLSchema">',i.Helper.encodeValue(t),"<\/b:value>","<\/a:KeyValuePairOfstringanyType>","<\/a:Parameters>",'<a:RequestId i:nil="true" />',"<a:RequestName>RetrieveAttribute<\/a:RequestName>","<\/request>"].join("");return u._doRequest(f,"Execute").then(function(n){for(var f,i=u.__selectNodes(n,"//b:value"),r=[],t=0,e=i.length;t<e;t++)f=u.__objectifyNode(i[t]),r.push(f);return r})},n.SoapClientFactory=function(t){return new n(t)},n.id="ngXrm.XrmServiceToolkit.Soap.SoapClient",n.$inject=["$http"],n}();t.SoapClient=r})(i=t.Soap||(t.Soap={}))})(t=n.XrmServiceToolkit||(n.XrmServiceToolkit={}))}(ngXrm||(ngXrm={})),function(n){var t;(function(t){var i;(function(t){var i=n.XrmServiceToolkit.Common,r=n.XrmServiceToolkit.Common.Rest,u=function(){function n(n){this.$http=n}return n.prototype.__getODataPath=function(n){var t=this;return[n.getClientUrl(),"/XRMServices/2011/OrganizationData.svc/"].join("")},n.prototype.__parameterCheckBoolean=function(n,t){if(typeof n!="boolean")throw new Error(t);},n.prototype.__parameterCheckRequired=function(n,t){if(typeof n=="undefined"||n===null)throw new Error(t);},n.prototype.__parameterCheckString=function(n,t){if(typeof n!="string")throw new Error(t);},n.prototype._restGet=function(n){var i=this,t={headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"}};return n.httpConfig!=null&&(t=n.httpConfig),i.$http.get(n.requestUrl,t).then(function(n){var t=null;return n.status===200&&(t=n.data.d),t}).catch(function(n){return Q.reject(n)})},n.prototype._restPost=function(n){var i=this,t={headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8"}};return n.httpConfig!=null&&(t=n.httpConfig),i.$http.post(n.requestUrl,n.object!=null?JSON.stringify(n.object):null,t).then(function(n){var t=null;return n.status===200||n.status===201?t=n.data.d:n.status===204&&(t="Ok"),t}).catch(function(n){return Q.reject(n)})},n.prototype.createRecord=function(n,t){var u=this,f;try{u.__parameterCheckRequired(t,"ngXrm.XrmServiceToolkit.Rest.RestClient.createRecord requires the object parameter.");u.__parameterCheckString(n,"ngXrm.XrmServiceToolkit.Rest.RestClient.createRecord requires the type parameter is a string.")}catch(e){return Q.reject(e)}return f=[u.__getODataPath(i.Helper.xrmContext()),n,"Set"].join(""),u._restPost(new r.RestPost({requestUrl:f,object:t})).then(function(n){return n})},n.prototype.retrieveRecord=function(n,t,u,f){var h=this,e,o,s,c,l;try{h.__parameterCheckString(n,"ngXrm.XrmServiceToolkit.Rest.RestClient.retrieveRecord requires the id parameter is a string.");h.__parameterCheckString(t,"ngXrm.XrmServiceToolkit.Rest.RestClient.retrieveRecord requires the type parameter is a string.")}catch(a){return Q.reject(a)}if(e="",o=[],f!=null)for(s=0;s<f.length;s++)if(o.push(f[s]),s==5)break;return(u!=null||f!=null)&&(e="?",u!=null&&(c=["$select=",u.join(",")].join(""),o.length>0&&(c=[c,o.join(",")].join(",")),e=[e,c].join("")),o.length>0&&(e=[e,"&$expand=",o.join(",")].join(""))),l=[h.__getODataPath(i.Helper.xrmContext()),t,"Set(guid'",n,"')",e].join(""),h._restGet(new r.RestGet({requestUrl:l})).then(function(n){return n})},n.prototype.updateRecord=function(n,t,u){var f=this,e,o;try{f.__parameterCheckString(n,"ngXrm.XrmServiceToolkit.Rest.RestClient.updateRecord requires the id parameter.");f.__parameterCheckRequired(u,"ngXrm.XrmServiceToolkit.Rest.RestClient.updateRecord requires the object parameter.");f.__parameterCheckString(t,"ngXrm.XrmServiceToolkit.Rest.RestClient.updateRecord requires the type parameter.")}catch(s){return Q.reject(s)}return e=[f.__getODataPath(i.Helper.xrmContext()),t,"Set(guid'",n,"')"].join(""),o={headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8","X-HTTP-Method":"MERGE"}},f._restPost(new r.RestPost({requestUrl:e,object:u,httpConfig:o})).then(function(n){return n})},n.prototype.deleteRecord=function(n,t){var u=this,f,e;try{u.__parameterCheckString(n,"ngXrm.XrmServiceToolkit.Rest.RestClient.deleteRecord requires the id parameter.");u.__parameterCheckString(t,"ngXrm.XrmServiceToolkit.Rest.RestClient.deleteRecord requires the type parameter.")}catch(o){return Q.reject(o)}return f=[u.__getODataPath(i.Helper.xrmContext()),t,"Set(guid'",n,"')"].join(""),e={headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8","X-HTTP-Method":"DELETE"}},u._restPost(new r.RestPost({requestUrl:f,httpConfig:e})).then(function(n){return n})},n.prototype._doRetrieveMultipleRecords=function(n,t){var u,f,e;return t===void 0&&(t=null),u=this,f="",t!=null&&(f=t.charAt(0)!=="?"?["?",t].join(""):t),e=[u.__getODataPath(i.Helper.xrmContext()),n,"Set",f].join(""),u._restGet(new r.RestGet({requestUrl:e})).then(function(n){return n}).catch(function(n){return Q.reject(n)})},n.prototype.retrieveMultipleRecords=function(n,t){var r;t===void 0&&(t=null);r=this;try{r.__parameterCheckString(n,"ngXrm.XrmServiceToolkit.Rest.RestClient.retrieveMultipleRecords requires the type parameter is a string.");t!=null&&r.__parameterCheckString(t,"ngXrm.XrmServiceToolkit.Rest.RestClient.retrieveMultipleRecords requires the options parameter is a string.")}catch(o){return Q.reject(o)}var u=Q.defer(),f=[],e=function(t){if(t!=null)if(f.push.apply(f,t.results),t.__next!=null){var o=t.__next.substring([r.__getODataPath(i.Helper.xrmContext()),n,"Set"].join("").length);r._doRetrieveMultipleRecords(n,o).then(e).catch(function(n){return u.reject(n)})}else u.resolve(f)};return r._doRetrieveMultipleRecords(n,t).then(e).catch(function(n){return u.reject(n)}),u.promise},n.prototype.associateRecord=function(n,t,u,f,e){var o=this,s,h;try{o.__parameterCheckRequired(n,"ngXrm.XrmServiceToolkit.Rest.RestClient.associateRecord requires the entityid1 parameter.");o.__parameterCheckRequired(t,"ngXrm.XrmServiceToolkit.Rest.RestClient.associateRecord requires the odataSetName1 parameter.");o.__parameterCheckRequired(u,"ngXrm.XrmServiceToolkit.Rest.RestClient.associateRecord requires the entityid2 parameter.");o.__parameterCheckRequired(f,"ngXrm.XrmServiceToolkit.Rest.RestClient.associateRecord requires the odataSetName2 parameter.");o.__parameterCheckRequired(e,"ngXrm.XrmServiceToolkit.Rest.RestClient.associateRecord requires the relationship parameter.")}catch(c){return Q.reject(c)}return s={},s.uri=[o.__getODataPath(i.Helper.xrmContext()),f,"Set(guid'",u,"')"].join(""),h=[o.__getODataPath(i.Helper.xrmContext()),t,"Set(guid'",n,"')/$links/",e].join(""),o._restPost(new r.RestPost({requestUrl:h,object:s})).then(function(n){return n!=null&&n.data!=null?n.data.d:null})},n.prototype.disassociateRecord=function(n,t,u,f){var e=this,o,s;try{e.__parameterCheckRequired(n,"ngXrm.XrmServiceToolkit.Rest.RestClient.disassociateRecord requires the entityid1 parameter.");e.__parameterCheckRequired(t,"ngXrm.XrmServiceToolkit.Rest.RestClient.disassociateRecord requires the odataSetName parameter.");e.__parameterCheckRequired(u,"ngXrm.XrmServiceToolkit.Rest.RestClient.disassociateRecord requires the entityid2 parameter.");e.__parameterCheckRequired(f,"ngXrm.XrmServiceToolkit.Rest.RestClient.disassociateRecord requires the relationship parameter.")}catch(h){return Q.reject(h)}return o=[e.__getODataPath(i.Helper.xrmContext()),t,"Set(guid'",n,"')/$links/",f,"(guid'",u,"')"].join(""),s={headers:{Accept:"application/json","Content-Type":"application/json; charset=utf-8","X-HTTP-Method":"DELETE"}},e._restPost(new r.RestPost({requestUrl:o,httpConfig:s})).then(function(n){return n!=null&&n.data!=null?n.data.d:null})},n.RestClientFactory=function(t){return new n(t)},n.id="ngXrm.XrmServiceToolkit.Rest.RestClient",n.$inject=["$http"],n}();t.RestClient=u})(i=t.Rest||(t.Rest={}))})(t=n.XrmServiceToolkit||(n.XrmServiceToolkit={}))}(ngXrm||(ngXrm={}));angular.module("ngXrm",[]).factory("ngXrmServiceToolkitSoap",["$http",ngXrm.XrmServiceToolkit.Soap.SoapClient.SoapClientFactory]).factory("ngXrmServiceToolkitRest",["$http",ngXrm.XrmServiceToolkit.Rest.RestClient.RestClientFactory]);
//# sourceMappingURL=ngXrmServiceToolkit.min.js.map
